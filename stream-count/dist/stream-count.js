!async function(){for(;!Spicetify.React||!Spicetify.ReactDOM;)await new Promise(t=>setTimeout(t,10));var n,e,r,i;e=n=null,r=!1,i=[],(async()=>{console.log("Stream Count extension loaded!"),new MutationObserver(t=>{t.forEach(t=>{"childList"===t.type&&t.target===document.body&&d()})}).observe(document.body,{childList:!0,subtree:!0}),a(),d()})();async function a(t=0){if("undefined"!=typeof Spicetify&&Spicetify.Platform&&Spicetify.Platform.AuthorizationAPI){console.log("Spicetify loaded",Spicetify.Platform);try{return n=await Spicetify.Platform.Session.accessToken,d(),n}catch(t){return console.error("Error retrieving access token:",t),null}}else setTimeout(a,1e3)}async function c(e){let t="me/tracks"===e?`https://api.spotify.com/v1/${e}?limit=50`:`https://api.spotify.com/v1/playlists/${e}/tracks?limit=50`,r=[];try{for(;t;){var i=await fetch(t,{headers:{Authorization:"Bearer "+n,"Content-Type":"application/json"}});if(!i.ok){if(401===i.status)return console.log("Token expired, refreshing token..."),await a(!0),c(e);throw new Error("HTTP error! status: "+i.status)}var o=await i.json();r=r.concat(o.items),t=o.next}return r}catch(t){return console.error("Error fetching songs for :",e,t),[]}}async function s(){i&&0!==i.length?document.querySelectorAll(".main-trackList-trackListRow").forEach((t,e)=>{t.querySelectorAll('[role="gridcell"]').forEach((t,e)=>{t.setAttribute("aria-colindex",(e+1).toString())});var r=t.querySelector(".main-trackList-popularityCell");r||((r=document.createElement("div")).classList.add("main-trackList-rowSectionVariable","main-trackList-popularityCell"),r.setAttribute("role","gridcell"),r.setAttribute("aria-colindex","5"),r.textContent=i[e].track.popularity.toString(),(e=t.querySelector(".main-trackList-rowSectionEnd"))?t.insertBefore(r,e):t.appendChild(r),e&&e.setAttribute("aria-colindex","6"))}):console.error("No songs found!")}async function o(){var t,e,r=document.querySelector(".main-trackList-trackListHeader");r?(r=r.children[0],(t=document.createElement("div")).classList.add("main-trackList-rowSectionVariable"),t.setAttribute("role","columnheader"),t.setAttribute("aria-colindex","5"),t.setAttribute("aria-sort","none"),t.setAttribute("tabindex","-1"),t.style.display="flex",(e=document.createElement("button")).className="main-trackList-column main-trackList-sortable",e.tabIndex=-1,e.innerHTML='<span class="Text__TextElement-sc-if376j-0 TextElement-text-bodySmall encore-text-body-small standalone-ellipsis-one-line" data-encore-id="text">Popularity</span>',t.appendChild(e),(e=r.querySelector(".main-trackList-rowSectionEnd"))?(r.insertBefore(t,e),e.setAttribute("aria-colindex","6")):r.appendChild(t),(e=document.querySelector(".main-trackList-trackList.main-trackList-indexable"))&&(e.setAttribute("aria-colcount","6"),document.querySelector(".main-trackList-trackListRowGrid").style.gridTemplateColumns=`
      [index] var(--tracklist-index-column-width, 16px)
      [first] minmax(120px, var(--col1, 6fr))
      [var1] minmax(120px, var(--col2, 4fr))
      [var2] minmax(120px, var(--col3, 3fr))
      [var3] minmax(120px, var(--col4, 2fr))
      [last] minmax(120px, var(--col6, 1fr))
    `)):console.error("Header row not found")}function l(){const i=document.querySelector(".main-trackList-trackList");if(i){const o=new MutationObserver(t=>{let e=!1;for(const r of t)"childList"===r.type&&0<r.addedNodes.length&&(e=!0);e&&(o.disconnect(),s(),o.observe(i,{childList:!0,subtree:!0}))});o.observe(i,{childList:!0,subtree:!0})}else console.error("Track list element not found!")}async function d(){var t=document.querySelector("section[data-test-uri]");if(t){t=t.getAttribute("data-test-uri").split(":");if(t.includes("playlist")){t=t.pop();if(t&&t!==e)return e=t,r=!1,console.log("Playlist found! ID:",e),c(e).then(t=>{i=t,s(),l()}).catch(t=>{console.error("Error fetching songs:",t)}),void o()}}t=document.querySelector('[data-testid="playlist-page"] h1');if(t&&"Liked Songs"===t.textContent){if(!r)return r=!0,e=null,console.log("Liked songs page found!"),c("me/tracks").then(t=>{i=t,s(),l()}).catch(t=>{console.error("Error fetching songs:",t)}),void o()}else r=!1;e=null}}();